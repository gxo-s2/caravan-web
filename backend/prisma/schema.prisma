// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  // ğŸš¨ğŸš¨ğŸš¨ ì„ì‹œ ìˆ˜ì •: í™˜ê²½ ë³€ìˆ˜ ì˜¤ë¥˜ë¥¼ ìš°íšŒí•˜ê¸° ìœ„í•´ DB URLì„ ì½”ë“œì— ì§ì ‘ ì…ë ¥í•©ë‹ˆë‹¤.
  // ë§ˆì´ê·¸ë ˆì´ì…˜ ì„±ê³µ í›„ì—ëŠ” ë°˜ë“œì‹œ 'url = env("DATABASE_URL")'ë¡œ ë˜ëŒë ¤ì•¼ í•©ë‹ˆë‹¤.
  url      = "postgresql://neondb_owner:npg_E4aTOGwLz6xQ@ep-gentle-shadow-a1ux65ln-pooler.ap-southeast-1.aws.neon.tech/neondb?sslmode=require&channel_binding=require" 
}

model User {
  id             String    @id @default(cuid())
  email          String    @unique
  password       String
  name           String
  contactNumber  String?
  profilePicture String?
  isVerified     Boolean   @default(false)
  role           Role      @default(GUEST)
  createdAt      DateTime  @default(now())
  updatedAt      DateTime  @updatedAt

  caravans     Caravan[]
  reservations Reservation[]
  reviews      Review[]
  payments     Payment[] // âœ… [ì¶”ê°€] ìœ ì €ì˜ ê²°ì œ ë‚´ì—­ ì¡°íšŒìš©
}

model Caravan {
  id          String   @id @default(cuid())
  name        String
  description String
  location    String
  
  // âœ… [ìˆ˜ì •] ê°€ê²© ê³„ì‚°ì„ ì •ìˆ˜ë¡œ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ Intë¡œ ë³€ê²½ ë° ê¸°ë³¸ê°’ ì„¤ì •
  pricePerDay Int      @default(50000) 
  
  capacity    Int
  images      String[] // âœ… [ë³µêµ¬] ì´ë¯¸ì§€ ë°°ì—´ í•„ë“œê°€ í•„ìš”í•˜ì—¬ ì¶”ê°€ (ê¸°ì¡´ ì½”ë“œ ì°¸ê³ )
  
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  
  host        User     @relation(fields: [hostId], references: [id])
  hostId      String
  
  reservations Reservation[]
  reviews      Review[]
}

model Reservation {
  id         String            @id @default(cuid())
  startDate  DateTime
  endDate    DateTime
  totalPrice Int               // âœ… [ìˆ˜ì •] ê°€ê²© ê³„ì‚° ì¼ê´€ì„±ì„ ìœ„í•´ Intë¡œ ë³€ê²½ (Floatë„ ê°€ëŠ¥í•˜ë‚˜ Int ê¶Œì¥)
  status     ReservationStatus @default(PENDING)
  createdAt  DateTime          @default(now())
  updatedAt  DateTime          @updatedAt
  
  guest      User              @relation(fields: [guestId], references: [id])
  guestId    String
  
  caravan    Caravan           @relation(fields: [caravanId], references: [id])
  caravanId  String
  
  payment    Payment?          // âœ… [ì¶”ê°€] 1:1 ê²°ì œ ì •ë³´ ì—°ê²°
}

model Payment {
  id            String   @id @default(cuid())
  amount        Int      // âœ… [ìˆ˜ì •] ê°€ê²© ì¼ê´€ì„±ì„ ìœ„í•´ Intë¡œ ë³€ê²½
  
  // âœ… [ìˆ˜ì •] 'VIRTUAL_CARD' ë“± ë‹¤ì–‘í•œ ê°€ìƒ ê²°ì œ ìˆ˜ë‹¨ì„ í—ˆìš©í•˜ê¸° ìœ„í•´ Stringìœ¼ë¡œ ë³€ê²½
  // (Enumì„ ì“°ë©´ 'VIRTUAL_CARD' ê°’ì„ ë„£ì„ ë•Œ ì—ëŸ¬ê°€ ë°œìƒí•  ìˆ˜ ìˆìŒ)
  method        String   @default("CARD") 
  
  status        String   @default("COMPLETED")
  
  paymentDate   DateTime @default(now())
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  
  reservation   Reservation @relation(fields: [reservationId], references: [id])
  reservationId String      @unique
  
  // âœ… [ì¶”ê°€] ê²°ì œí•œ ìœ ì € ì •ë³´ ì—°ê²° (ê²°ì œ ì´ë ¥ ì¡°íšŒ ì‹œ í•„ìš”)
  user          User     @relation(fields: [userId], references: [id])
  userId        String
}

model Review {
  id        String   @id @default(cuid())
  rating    Int
  comment   String
  createdAt DateTime @default(now())
  
  author    User     @relation(fields: [authorId], references: [id])
  authorId  String
  
  caravan   Caravan  @relation(fields: [caravanId], references: [id])
  caravanId String
}

enum Role {
  GUEST
  HOST
}

enum ReservationStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

// PaymentMethod, PaymentStatus Enumì€ Stringìœ¼ë¡œ ëŒ€ì²´í•˜ì—¬ ìœ ì—°ì„±ì„ í™•ë³´í–ˆìŠµë‹ˆë‹¤.
// í•„ìš” ì‹œ ë‹¤ì‹œ í™œì„±í™”í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.